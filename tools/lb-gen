#!/usr/bin/env node
// This script generates JS constants with information about the language bar.
// Mentioned in http://wiki.dyalog.bramley/index.php/New_Glyphs
const cp=require('child_process'),fs=require('fs')
var e=cp.execSync('svn cat http://svn.dyalog.bramley/svn/docbin/trunk/documentation/elements.h',{encoding:'utf8'})
var o=e.match(/BLANK|CHAR\("[^"]*"\)/gm).map(s=>s.replace(/BLANK/,' ').replace(/CHAR\("([^"]*)"\)/,'$1')).join('')
var t=e.split(/^NAME/m).slice(1).map(function(z){
    var n=z.match(/^\("([^"]*)"\)/)[1]
    var c=z.match(/CHAR\("([^"]*)"\)/)[1]
    var t=z.match(/^\s*_\(".*"\)$/gm).map(s=>s.replace(/^\s*_\("(.*?)\s*"\)$/,'$1')).join('\\n').replace(/(\\n)*$/,'')
    return '"'+c+'":["'+n+' ('+c+')","'+t+'"]'
}).join(',\n')
fs.writeFileSync(__dirname+'/../src/lb.js',
    '//generated by tools/lb-gen\n'+
    ';(D=typeof D==="undefined"?{}:D).lb={//language bar information\n'+
    'order:"'+o+'",\n'+
    'tips:{\n'+
    t+'\n'+
    '}\n'+
    '}\n')
